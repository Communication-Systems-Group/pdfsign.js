<!DOCTYPE html>
<html>
<head>

<title>PDFSign</title>
<meta charset="utf-8"/>
  
<!-- inject:js -->
<script src="lib/forge-patched.js"></script>
<script src="lib/pdfjs.parser.js"></script>
<script src="pdfsign.js"></script>
<!-- endinject -->

</head>
<body>

  <table>
    <tr>
      <th>p12 Certificate</th><th>p12 Password</th><th>PDF file</th>
    </tr><tr>
      <td><input type="file" id="cert" name="cert[]" multiple /></td>
      <td><input type="password" id="pass" name="pass" /></td>
      <td><input type="file" id="pdf" name="pdf[]" multiple /></td>
    </tr>
  </table>
    
<script type="text/javascript">

var cert = new Uint8Array();
function handleFileSelect1(evt) {
    var file = evt.target.files[0];
    var reader = new FileReader();
    reader.onload = function (event) {
        cert = event.target.result;
    }
    reader.readAsArrayBuffer(file);
}
document.getElementById('cert').addEventListener('change', handleFileSelect1, false);

function handleFileSelect2(evt) {
    var file = evt.target.files[0];
    var reader = new FileReader();
    reader.onload = function (event) {
	var data = event.target.result;
	pdfSigned = PDFSIGN.signpdf(new Uint8Array(data), new Uint8Array(cert), document.getElementById('pass').value);
        createPDFDownload(pdfSigned, 'pdfSigned.pdf');
    }
    reader.readAsArrayBuffer(file);
}
document.getElementById('pdf').addEventListener('change', handleFileSelect2, false);

function createPDFDownload(array, filename) {
    var a = window.document.createElement('a');
    a.href = window.URL.createObjectURL(new Blob([array], { type: 'application/pdf' }));
    a.download = filename;
    // Append anchor to body.
    document.body.appendChild(a);
    a.click();
    // Remove anchor from body
    document.body.removeChild(a);
}   
</script>

</body>
</html>